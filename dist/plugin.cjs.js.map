{"version":3,"file":"plugin.cjs.js","sources":["esm/index.js","esm/web.js"],"sourcesContent":["import { registerPlugin } from '@capacitor/core';\nconst CapacitorSegment = registerPlugin('CapacitorSegment', {\n    web: () => import('./web').then(m => new m.CapacitorSegmentWeb()),\n});\nexport * from './definitions';\nexport { CapacitorSegment };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nconst getSegmentScript = (key) => `!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error(\"Segment snippet included twice.\");else{analytics.invoked=!0;analytics.methods=[\"trackSubmit\",\"trackClick\",\"trackLink\",\"trackForm\",\"pageview\",\"identify\",\"reset\",\"group\",\"track\",\"ready\",\"alias\",\"debug\",\"page\",\"once\",\"off\",\"on\",\"addSourceMiddleware\",\"addIntegrationMiddleware\",\"setAnonymousId\",\"addDestinationMiddleware\"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement(\"script\");t.type=\"text/javascript\";t.async=!0;t.src=\"https://cdn.segment.com/analytics.js/v1/\" + key + \"/analytics.min.js\";var n=document.getElementsByTagName(\"script\")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey=\"${key}\";analytics.SNIPPET_VERSION=\"4.13.2\";\nanalytics.load(\"${key}\");\nanalytics.page();\n}}();`;\nexport class CapacitorSegmentWeb extends WebPlugin {\n    async initialize(options) {\n        await this.loadScript('segment', getSegmentScript(options.key));\n    }\n    async identify(options) {\n        if (!window.analytics)\n            return Promise.reject('Segment is not initialized');\n        if (!options.userId)\n            return Promise.reject(\"User ID is required for 'identify' but not supplied\");\n        window.analytics.identify(options.userId, options.traits, options.options);\n    }\n    async track(options) {\n        if (!window.analytics)\n            return Promise.reject('Segment is not initialized');\n        if (!options.eventName)\n            return Promise.reject('Event name is not supplied');\n        window.analytics.track(options.eventName, options.properties);\n    }\n    async page(options) {\n        if (!window.analytics)\n            return Promise.reject('Segment is not initialized');\n        if (!options.pathname)\n            return Promise.reject('Pathname was not supplied');\n        window.analytics.page(options.pathname);\n    }\n    async reset() {\n        if (!window.analytics)\n            return Promise.reject('Segment is not initialized');\n        window.analytics.flush();\n    }\n    /**\n     * Loaded single script with provided id and source\n     * @param id - unique identifier of the script\n     * @param src - source of the script\n     */\n    loadScript(id, script) {\n        return new Promise((resolve) => {\n            if (document.getElementById(id)) {\n                resolve(null);\n            }\n            else {\n                const node = document.createTextNode(script);\n                const file = document.createElement(\"script\");\n                file.type = \"text/javascript\";\n                file.id = id;\n                file.onload = resolve;\n                file.onerror = console.error;\n                file.appendChild(node);\n                document.head.appendChild(file);\n            }\n        });\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":["registerPlugin","WebPlugin"],"mappings":"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"}